function parentHasClass(t,e){for(var a,s=t,i=!1,o=[];null!=s.parentNode&&0==i;)o.push(s),s.classList&&s.classList.contains(e)&&(i=!0,a=s),s=s.parentNode;return{containsClassName:i,classElement:a,childs:o}}function fillObjDefaults(t,e){for(var a=Object.keys(e),s=0;s<a.length;s++)void 0==t[a[s]]&&(t[a[s]]=e[a[s]]);return t}var tabControlReference={currTabGroup:"none"};window.addEventListener("mousedown",function(t){var e=parentHasClass(t.target,"tab-group"),a=e.classElement;1==e.containsClassName&&1!=a.initialized&&(a.activeItem&&a.activeItem.classList.contains("dragging")&&(console.log("Bug Handling"),a.activeItem.left=0),1!=a.initialized&&a.initTabGroup(a),a.mouseDownHandler(e.childs[e.childs.length-2],t))},!1),window.addEventListener("mouseup",function(t){var e=tabControlReference.currTabGroup;e.mouseDown=!1;var a=!1;if(e.dragFireCount>0){for(var s=0;s<e.tabItemsDraggable.length;s++)t.pageX>e.tabItemsDraggable[s].leftDiff&&t.pageX<e.tabItemsDraggable[s].leftDiff+e.tabItemsDraggable[s].offsetWidth&&(e.activeItem.newNodePos=e.tabItemsDraggable[s].nodePos,a=!0);if(t.pageX<e.tabItemsDraggable[0].leftDiff&&0==a){for(var i=0;1==e.tabItems[i].classList.contains("tab-item-fixed");)i++;e.activeItem.newNodePos=i}e.moveItem(e.activeItem,e.activeItem.newNodePos,!0)}e.dragFireCount=0},!1),window.addEventListener("mousemove",function(t){var e=tabControlReference.currTabGroup;if(1==e.mouseDown&&0==e.activeItem.classList.contains("tab-item-fixed")){if(e.dragFireCount++,1==e.dragFireCount)for(var a=0;a<e.tabItemsDraggable.length;a++)e.tabItemsDraggable[a].style.width=e.tabItemsDraggable[a].offsetWidth+"px",e.tabItemsDraggable[a].classList.add("dragging");var s=t.pageX-e.dragStart;e.activeItem.style.left=s+"px";var i=new CustomEvent("tabDrag",{detail:{tabPosition:e.activeItem.nodePos,tab:e.activeItem,drag:s}});e.dispatchEvent(i);for(var a=0;a<e.tabItemsDraggable.length;a++)e.tabItemsDraggable[a]!=tabControlReference.currTabGroup.activeItem&&0==e.tabItemsDraggable[a].classList.contains("btn")&&(e.tabItemsDraggable[a].nodePos<tabControlReference.currTabGroup.activeItem.nodePos&&(e.tabItemsDraggable[a].leftDiff+e.tabItemsDraggable[a].offsetWidth>t.pageX?(e.tabItemsDraggable[a].left=tabControlReference.currTabGroup.activeItem.offsetWidth,e.tabItemsDraggable[a].leftDiff<t.pageX&&tabControlReference.currTabGroup.activeItem.newNodePos--):e.tabItemsDraggable[a].left=0),e.tabItemsDraggable[a].nodePos>tabControlReference.currTabGroup.activeItem.nodePos&&(e.tabItemsDraggable[a].leftDiff<t.pageX?(e.tabItemsDraggable[a].left=0-tabControlReference.currTabGroup.activeItem.offsetWidth,e.tabItemsDraggable[a].leftDiff+e.tabItemsDraggable[a].offsetWidth>t.pageX&&(tabControlReference.currTabGroup.activeItem.newNodePos=e.tabItemsDraggable[a].nodePos)):e.tabItemsDraggable[a].left=0),e.tabItemsDraggable[a].left!=e.tabItemsDraggable[a].leftBefore&&(e.tabItemsDraggable[a].drags++,e.tabItemsDraggable[a].style.left=e.tabItemsDraggable[a].left+"px"),e.tabItemsDraggable[a].leftBefore=e.tabItemsDraggable[a].left)}},!1),HTMLDivElement.prototype.initTabGroup=function(t){if(t.classList.contains("tab-group")&&1!=t.initialized){tabControlReference.currTabGroup=t,t.tabItems=t.getElementsByClassName("tab-item"),t.tabItemsDraggable=[];for(var e=0;e<t.tabItems.length;e++)0==t.tabItems[e].classList.contains("tab-item-fixed")&&t.tabItemsDraggable.push(t.tabItems[e]);t.activeItem=t.getElementsByClassName("active")[0],t.dragStart=0,t.dragFireCount=0,t.initTabItem=function(e,a){e.addEventListener("mousedown",function(e){t.mouseDownHandler(this,e)},!1),e.nodePos=a,e.left=0,e.leftBefore=0};for(var e=0;e<t.tabItems.length;e++)t.initTabItem(t.tabItems[e],e);t.mouseDownHandler=function(e,a){var s=parentHasClass(a.target,"icon-close-tab");if(0==s.containsClassName&&0==e.classList.contains("btn")){t.mouseDown=!0,t.dragStart=a.pageX;for(var i=0;i<t.tabItems.length;i++)t.tabItems[i].leftDiff=t.tabItems[i].offsetLeft,t.tabItems[i].newNodePos=t.tabItems[i].nodePos,t.tabItems[i].style.left="0px";t.activateItem(e)}},t.initialized=!0}},HTMLDivElement.prototype.activateItem=function(t){var e=parentHasClass(this,"tab-group");if(1==e.containsClassName&&0==t.classList.contains("btn")){if(1!=this.initialized&&this.initTabGroup(this),0==t.classList.contains("active")){this.activeItem&&this.activeItem.classList.remove("active"),this.activeItem=t,t.classList.add("active");var a=new CustomEvent("tabActivate",{detail:{tabPosition:t.nodePos,tab:t}});this.dispatchEvent(a)}}else console.log("Not allowed")},HTMLDivElement.prototype.moveItem=function(t,e,a){var s=parentHasClass(this,"tab-group");if(1==s.containsClassName&&1==t.classList.contains("tab-item")){1!=this.initialized&&this.initTabGroup(this);var i=1e3*parseFloat(window.getComputedStyle(t,null).getPropertyValue("transition-duration").replace("s",""));1!=a&&(i=0),t.classList.add("active-in-transition");var o=parseInt(t.style.left.replace("px","")),n=this.tabItems[e].leftDiff-t.offsetLeft,r=n+o,l=t.nodePos;setTimeout(function(a,s){a.style.left=r+"px",setTimeout(function(a){if(t.nodePos!=e){if(t.nodePos<e)var s=a.tabItems[e+1];if(t.nodePos>e)var s=a.tabItems[e];a.insertBefore(t,s)}t.classList.remove("active-in-transition");for(var i=0;i<a.tabItems.length;i++)a.tabItems[i].classList.remove("dragging"),a.tabItems[i].style.removeProperty("width"),a.tabItems[i].style.removeProperty("left"),a.tabItems[i].nodePos=i,a.tabItems[i].left=0,a.tabItems[i].leftBefore=0,a.tabItems[i].mouseDown=!1;if(a.dragStart=0,a.dragFireCount=0,l!=e){var o=new CustomEvent("tabPositionChange",{detail:{tabPositionBefore:l,tabPositionNew:e,tab:t}});a.dispatchEvent(o)}},i,s)},10,t,this)}else console.log("Not allowed")},HTMLDivElement.prototype.addTab=function(t){if(this.classList.contains("tab-group")){t=fillObjDefaults(t,{position:"last",closeBtn:!0,isActive:!1,animated:!0,content:"New Tab"});var e=document.createElement("div");if(1==t.closeBtn){var a=document.createElement("span");a.classList.add("icon-close-tab"),e.appendChild(a)}if("object"!=typeof t.content||void 0==t.content.tagName&&void 0==t.content.nodeValue)if("string"==typeof t.content)var s=document.createTextNode(t.content);else console.log("Is something else",t.content);else var s=t.content;e.classList.add("tab-item"),e.appendChild(s);var i=this.getElementsByClassName("tab-item");if("last"==t.position){for(var o=i.length-1;void 0!=i[o]&&i[o].classList.contains("tab-item-fixed");)o--;this.insertBefore(e,i[o+1])}if("first"==t.position){for(var o=0;void 0!=i[o]&&i[o].classList.contains("tab-item-fixed");)o++;this.insertBefore(e,i[o])}if(1==t.isActive)if(1==this.initialized)this.activateItem(e);else{var n=this.getElementsByClassName("active");n.length>0&&n[0].classList.remove("active"),e.classList.add("active")}if(1==t.animated){console.log("Animation...");var r=e.offsetWidth;e.classList.add("adding");var l=1e3*parseFloat(window.getComputedStyle(e,null).getPropertyValue("transition-duration").replace("s",""));console.log(l),setTimeout(function(){e.style.width=r+"px",setTimeout(function(){e.style.removeProperty("width"),e.classList.remove("adding")},l)},10)}return this.initialized=!1,e}};
